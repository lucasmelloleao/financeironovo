/***************************************************************************
 Exemplo JSON vindo do Server
 ***************************************************************************/
var jsonOrgan = (JSON.parse(conteudo.value));









var jsonOrgan2 = [{
        "id": 1,
        "cargo": "Conselheiros",
        "nome": "++",
        "idcargo": 1,
        "pai": 0
    }, {
        "id": 2,
        "cargo": "Conselho Fiscal",
        "nome": "++",
        "idcargo": 2,
        "pai": 1
    }, {
        "id": 3,
        "cargo": "Suplentes",
        "nome": "++",
        "idcargo": 3,
        "pai": 1
    }, {
        "id": 4,
        "cargo": "Suplentes Conselho Fiscal",
        "nome": "++",
        "idcargo": 4,
        "pai": 2
    }, {
        "id": 5,
        "cargo": "Diretoria Executiva",
        "nome": "++",
        "idcargo": 5,
        "pai": 2
    }, {
        "id": 6,
        "cargo": "I. Departamento Administrativo",
        "nome": "++",
        "idcargo": 6,
        "pai": 5
    }, {
        "id": 7,
        "cargo": "II. Departamento de Assistência e Promoção Social",
        "nome": "++",
        "idcargo": 7,
        "pai": 5
    }, {
        "id": 8,
        "cargo": "III. Departamento de Difusão",
        "nome": "++",
        "idcargo": 8,
        "pai": 5
    }, {
        "id": 9,
        "cargo": "IV. Departamento Doutrinário",
        "nome": "++",
        "idcargo": 9,
        "pai": 5
    }, {
        "id": 11,
        "cargo": "V. Departamento de Infância e Juventude (DIJ)",
        "nome": "++",
        "idcargo": 11,
        "pai": 5
    }, {
        "id": 12,
        "cargo": "VI. Departamento de Promoções e Eventos",
        "nome": "++",
        "idcargo": 12,
        "pai": 5
    }, {
        "id": 13,
        "cargo": "1. Contábil / Fiscal",
        "nome": "++",
        "idcargo": 13,
        "pai": 6
    }, {
        "id": 14,
        "cargo": "2. Patrimônio",
        "nome": "++",
        "idcargo": 14,
        "pai": 6
    }, {
        "id": 15,
        "cargo": "3. Financeiro",
        "nome": "++",
        "idcargo": 15,
        "pai": 6
    }, {
        "id": 16,
        "cargo": "4. Recursos Humanos",
        "nome": "++",
        "idcargo": 16,
        "pai": 6
    }, {
        "id": 17,
        "cargo": "5. Informatização/Site/Treinamento",
        "nome": "++",
        "idcargo": 17,
        "pai": 6
    }, {
        "id": 18,
        "cargo": "1. Almoço do 1º domingo",
        "nome": "++",
        "idcargo": 18,
        "pai": 7
    }, {
        "id": 19,
        "cargo": "2. Caravana Fraterna",
        "nome": "++",
        "idcargo": 19,
        "pai": 7
    }, {
        "id": 20,
        "cargo": "3. Fabrica de pães",
        "nome": "++",
        "idcargo": 20,
        "pai": 7
    }, {
        "id": 21,
        "cargo": "4. Refeição Fraterna",
        "nome": "++",
        "idcargo": 21,
        "pai": 7
    }, {
        "id": 22,
        "cargo": "5. Relações Internas",
        "nome": "++",
        "idcargo": 22,
        "pai": 7
    }, {
        "id": 23,
        "cargo": "1. Biblioteca",
        "nome": "++",
        "idcargo": 23,
        "pai": 8
    }, {
        "id": 24,
        "cargo": "2. Escala de eventos doutrinários",
        "nome": "++",
        "idcargo": 24,
        "pai": 8
    }, {
        "id": 25,
        "cargo": "3. Feiras do Livro",
        "nome": "++",
        "idcargo": 25,
        "pai": 8
    }, {
        "id": 26,
        "cargo": "4. Livraria",
        "nome": "++",
        "idcargo": 26,
        "pai": 8

    }, {
        "id": 27,
        "cargo": "1. Dialogo Fraterno",
        "nome": "++",
        "idcargo": 27,
        "pai": 9
    }, {
        "id": 28,
        "cargo": "2. Grupo de Estudos da terça-feira",
        "nome": "++",
        "idcargo": 28,
        "pai": 9
    }, {
        "id": 29,
        "cargo": "3. Grupo de Estudos da quinta-feira",
        "nome": "++",
        "idcargo": 29,
        "pai": 9
    }, {
        "id": 30,
        "cargo": "4. Grupo de Estudos de Sábado 14h",
        "nome": "++",
        "idcargo": 30,
        "pai": 9
    }, {
        "id": 31,
        "cargo": "5. Palestras do 1º domingo",
        "nome": "++",
        "idcargo": 31,
        "pai": 9
    }, {
        "id": 32,
        "cargo": "6. Palestras do sábado",
        "nome": "++",
        "idcargo": 32,
        "pai": 9
    }, {
        "id": 33,
        "cargo": "7. Reunião de integração 1º domingo (Evangelho no Lar)",
        "nome": "++",
        "idcargo": 33,
        "pai": 9
    }, {
        "id": 34,
        "cargo": "8. Reunião Mediúnica",
        "nome": "++",
        "idcargo": 34,
        "pai": 9
    }, {
        "id": 35,
        "cargo": "9. Equipe de Passes",
        "nome": "++",
        "idcargo": 35,
        "pai": 9
    }, {
        "id": 36,
        "cargo": "1. Evangelização do 1º domingo",
        "nome": "++",
        "idcargo": 36,
        "pai": 11
    }, {
        "id": 37,
        "cargo": "2. Evangelização da Juventude",
        "nome": "++",
        "idcargo": 37,
        "pai": 11
    }, {
        "id": 38,
        "cargo": "3. Evangelização do Sábado a Noite",
        "nome": "++",
        "idcargo": 38,
        "pai": 11
    }
    , {
        "id": 39,
        "cargo": "1. Bazar",
        "nome": "++",
        "idcargo": 39,
        "pai": 12
    }, {
        "id": 40,
        "cargo": "2. Confraternização da SEM",
        "nome": "++",
        "idcargo": 40,
        "pai": 12
    }, {
        "id": 41,
        "cargo": "3. Refeições Beneficentes",
        "nome": "++",
        "idcargo": 41,
        "pai": 12
    }, {
        "id": 42,
        "cargo": "4. Eventos (Teatros,Apresentações Musicais...)",
        "nome": "+",
        "idcargo": 42,
        "pai": 12
    }, {
        "id": 43,
        "cargo": "5. Coral",
        "nome": "++",
        "idcargo": 43,
        "pai": 12
    }
];

var $organogramaEx = $("#organograma-exemplo"),
        fnShowHide,
        fnOffset,
        fnTamanhoHorizontal;

/***************************************************************************
 Criação do fluxograma no DOM
 ***************************************************************************/

(function createDOM() {
    var ul, li, div, docfrag, i = 0;
    for (var property in jsonOrgan) {
        if (jsonOrgan.hasOwnProperty(property)) {
            if (!document.getElementById("ul-" + jsonOrgan[property].pai)) {
                docfrag = document.createDocumentFragment();
                i++;
                if (i > 1) {
                    //var divZoom
                    //<div class="zoom mais"></div>
                    divZoom = document.createElement("div");
                    divZoom.setAttribute("class", "zoom mais");

                    //var divBarraHorizontal
                    //<div class="barrahorizontal"></div>
                    divBarraHorizontal = document.createElement("div");
                    divBarraHorizontal.setAttribute("class", "barrahorizontal");
                    divZoom.appendChild(divBarraHorizontal);

                    //var divBarraVertical
                    //<div class="barravertical"></div>
                    divBarraVertical = document.createElement("div");
                    divBarraVertical.setAttribute("class", "barravertical");
                    divZoom.appendChild(divBarraVertical);

                    //var divZoom
                    // <div class="zoom mais">
                    // <div class="barrahorizontal"></div>
                    // <div class="barravertical"></div>
                    // </div>

                    docfrag.appendChild(divZoom)
                }

                //var ul
                //<ul id="ul-" + jsonOrgan[property].pai" class="hide"></ul>
                ul = document.createElement("ul");
                ul.setAttribute("id", "ul-" + jsonOrgan[property].pai);
                ul.setAttribute("class", "hide");
                docfrag.appendChild(ul);

                document.getElementById("li-" + jsonOrgan[property].pai).appendChild(docfrag)
            }

            var url_atual = window.location.href;
            //var li
            //<li id="li-" + jsonOrgan[property].idcargo></li>
            li = document.createElement("li");
            li.setAttribute("id", "li-" + jsonOrgan[property].idcargo);
            //   document.getElementById("ul-" + jsonOrgan[property].pai).appendChild(li).innerHTML = '<div class="wrap-infos wrap-infos-padrao">' + '<p class="nome">' + jsonOrgan[property].nome + "</p>" + '<p class="cargo">' + jsonOrgan[property].cargo + "</p>" + "</div>"
            var pathparts = location.pathname.split('/');

            if (location.host == 'localhost') {

                var url = location.origin + '/' + pathparts[1].trim('/') + '/public/buscaorganograma'; // http://localhost/myproject/
            } else {
                var url = location.origin; // http://stackoverflow.com
            }
            
            
            if (location.host == 'localhost:8080') {
                var url = location.origin + '/' + pathparts[1].trim('/') + '/public/buscaorganograma'; // http://localhost/myproject/
            }


console.log (url);
            document.getElementById("ul-" + jsonOrgan[property].pai).appendChild(li).innerHTML = '<div class="wrap-infos wrap-infos-padrao">' + '<p class="cargo">' + jsonOrgan[property].cargo + "</p>" + '<p class="nome">' + '<a href="' + url + "/" + jsonOrgan[property].id + '">' + "<br>" + '<img src="images/1.png" width="20px" height="20px"> ' + "</p>" + "</div>"
        }
    }
})();

/***************************************************************************
 Tamanho horizontal (scrollbar) da tela
 ***************************************************************************/

fnTamanhoHorizontal = function () {
    var l = [];
    $organogramaEx
            .css("width", 10000);
    $organogramaEx
            .find("ul")
            .not(".hide")
            .each(function (i) {
                l[i] = $(this).width()
            });
    l.sort(function (a, b) {
        return a - b
    });
    l.pop();
    $organogramaEx
            .css("width", l.pop())
}

/***************************************************************************
 Click nos Botões de Zoom
 ***************************************************************************/

fnShowHide = function (element) {
    element
            .toggleClass("mais")
            .toggleClass("menos");
    element
            .siblings("ul")
            .toggleClass("hide");
    $(".hightlight")
            .removeClass("hightlight");
    element
            .prevAll(".wrap-infos")
            .addClass("hightlight");
};


/***************************************************************************
 Alinhando o ramo ativo mais próximo do centro da tela.
 ***************************************************************************/

fnOffset = function ($btn) {
    var l, t;
    l = $btn
            .prevAll(".wrap-infos")
            .offset()
            .left;
    t = $btn
            .prevAll(".wrap-infos")
            .offset()
            .top;

    setTimeout(function () {
        $(document).scrollLeft(l - $(window).width() / 2 + 60);
        $(document).scrollTop(t)
    }, 25)
};

$organogramaEx.find(".zoom").each(function () {
    var $thisButton = $(this);
    $thisButton.on("click", function () {
        fnShowHide($thisButton);
        fnTamanhoHorizontal();
        fnOffset($thisButton)
    })
});

$("#organograma-infos").find(".zoom").each(function () {
    var $thisButton = $(this);
    $thisButton.on("click", function () {
        fnShowHide($thisButton)
    })
});

/***************************************************************************
 Seletores Adicionais
 ***************************************************************************/

$(".organograma li:last-child")
        .addClass("ultimo-filho");
$(".organograma li:only-child")
        .addClass("filho-unico");

/***************************************************************************
 Ramos a mostrar logo após carregamento da página
 ***************************************************************************/

$("#ul-1,#ul-2")
        .removeClass("hide");

fnTamanhoHorizontal();